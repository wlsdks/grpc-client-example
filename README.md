# gRPC 성능 테스트 클라이언트

이 프로젝트는 gRPC와 HTTP(Feign) 프로토콜의 성능을 비교 테스트하기 위한 클라이언트 애플리케이션입니다. 두 프로토콜의 실제 성능 차이를 측정하고 분석할 수 있도록 설계되었습니다.

## 프로젝트 설정

이 애플리케이션은 Java 21과 Spring Boot 3.3.7을 기반으로 합니다. 프로젝트를 실행하기 전에 다음 요구사항이 충족되어야 합니다:

1. Java 21 이상이 설치되어 있어야 합니다.
2. 테스트 대상이 되는 서버 애플리케이션이 실행 중이어야 합니다.
- https://github.com/wlsdks/grpc-server-example (gRPC 서버 예시)
    - HTTP 엔드포인트: localhost:8090
    - gRPC 엔드포인트: localhost:50051

## 애플리케이션 실행 방법

먼저 gradle을 사용하여 프로젝트를 빌드합니다:

```bash
./gradlew clean build
```

그 다음, 애플리케이션을 실행합니다:

```bash
java -jar build/libs/performance-test-client-0.0.1-SNAPSHOT.jar
```

애플리케이션은 기본적으로 8091 포트에서 실행됩니다.

## 성능 테스트 실행 방법

성능 테스트는 HTTP API를 통해 실행할 수 있습니다. 다음 엔드포인트를 사용하여 테스트를 시작할 수 있습니다:

```bash
curl -X POST "http://localhost:8091/test/performance?totalRequests=10000&concurrentRequests=100"
```

매개변수 설명:
- totalRequests: 전체 요청 수 (기본값: 10000)
- concurrentRequests: 동시 요청 수 (기본값: 100)

## 테스트 결과 해석

테스트가 완료되면 애플리케이션 로그에서 다음과 같은 정보를 확인할 수 있습니다:

- 각 프로토콜(HTTP, gRPC)의 총 실행 시간
- 요청당 평균 처리 시간
- 최소/최대 응답 시간
- 초당 처리량(throughput)

예시 로그 출력:
```
=== HTTP 테스트 결과 ===
총 실행 시간: 633ms
총 요청 수: 10000
성공한 요청 수: 9998
실패한 요청 수: 2
최소 응답 시간: 1ms
최대 응답 시간: 103ms
95번째 백분위 응답 시간: 13ms
99번째 백분위 응답 시간: 73ms

=== gRPC 테스트 결과 ===
총 실행 시간: 528ms
총 요청 수: 10000
성공한 요청 수: 10000
실패한 요청 수: 0
최소 응답 시간: 1ms
최대 응답 시간: 157ms
95번째 백분위 응답 시간: 7ms
99번째 백분위 응답 시간: 133ms
```

## 주의사항

1. 첫 번째 테스트 실행은 JVM 웜업 효과로 인해 실제보다 높은 지연 시간을 보일 수 있습니다. 정확한 측정을 위해서는 여러 번의 테스트를 수행하는 것이 좋습니다.

2. 테스트를 실행하기 전에 반드시 서버 애플리케이션이 실행 중이어야 합니다.

3. 운영 환경과 유사한 조건에서 테스트하기 위해서는 다음 사항을 고려하세요:
    - 서버와 클라이언트를 다른 머신에서 실행
    - 다양한 크기의 페이로드로 테스트
    - 네트워크 지연이 있는 환경에서의 테스트

## 문제 해결

만약 "ObjectOptimisticLockingFailureException" 오류가 발생한다면, 이는 동시에 같은 데이터를 저장하려고 시도하기 때문입니다. 이 문제는 테스트 요청마다 고유한 데이터를 생성하도록 설계되어 있어 발생하지 않아야 합니다.

## 추가 설정

필요한 경우 `application.yml` 파일에서 다음 설정을 수정할 수 있습니다:
- 서버 포트
- gRPC 서버 주소
- HTTP 서버 주소
- Feign 클라이언트 타임아웃 설정

이 테스트 클라이언트를 통해 실제 마이크로서비스 환경에서 gRPC와 HTTP의 성능 차이를 정확하게 측정하고 비교할 수 있습니다.